<dashboard>
  <search id="lsm_analyse_sources">
    <query>| savedsearch lsm_analyse_sourcetypes</query>
    <earliest>1</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <label>Sourcetype Monitor</label>
  <row>
    <panel>
      <title>Monitored invalid sourcetypes</title>
      <table>
        <search base="lsm_analyse_sources">
          <query>| where Status != "ok"</query>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="number" field="Status"></format>
        <format type="color" field="Status">
          <colorPalette type="map">{"outage":#DC4E41,"underload":#F8BE34,"overload":#F1813F}</colorPalette>
        </format>
        <format type="color" field="%">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <link target="_blank">search?q=earliest=-30d@d%20index=%22$row.Index$%22%20sourcetype=%22$row.Sourcetype$%22%20%7C%20stats%20values(source)%20as%20Sources%20by%20host%20%7C%20rename%20host%20AS%20Host&amp;earliest=-24h@h&amp;latest=now</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Monitored valid sourcetypes</title>
      <table>
        <search base="lsm_analyse_sources">
          <query>| where Status == "ok"</query>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Status">
          <colorPalette type="map">{"ok":#B6C75A}</colorPalette>
        </format>
        <drilldown>
          <link target="_blank">search?q=earliest=-30d@d%20index=%22$row.Index$%22%20sourcetype=%22$row.Sourcetype$%22%20%7C%20stats%20values(source)%20as%20Sources%20by%20host%20%7C%20rename%20host%20AS%20Host&amp;earliest=-24h@h&amp;latest=now</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Data Quality</title>
      <table>
        <search>
          <query>`lsm_set_index_internal` splunk_server=* source=*splunkd.log*
            (component=AggregatorMiningProcessor OR component=LineBreakingProcessor OR component=DateParserVerbose)
            (log_level=WARN OR log_level=ERROR)
            | rex field=event_message "Context: source(::|=)(?&lt;context_source&gt;[^\|]*?)\|host(::|=)(?&lt;context_host&gt;[^\|]*?)\|(?&lt;context_sourcetype&gt;[^\|]*?)\|"
            | eval data_source = if(isnull(data_source) AND isnotnull(context_source), context_source, data_source)
            | eval data_host = if(isnull(data_host) AND isnotnull(context_host), context_host, data_host)
            | eval data_sourcetype = if(isnull(data_sourcetype) AND isnotnull(context_sourcetype), context_sourcetype, data_sourcetype)
            | stats
              count(eval(component=="LineBreakingProcessor" OR component=="DateParserVerbose" OR component=="AggregatorMiningProcessor")) as total_issues
              dc(data_host) AS "Host Count"
              dc(data_source) AS "Source Count"
              count(eval(component=="LineBreakingProcessor")) AS "Line Breaking Issues"
              count(eval(component=="DateParserVerbose")) AS "Timestamp Parsing Issues"
              count(eval(component=="AggregatorMiningProcessor")) AS "Aggregation Issues" by data_sourcetype
            | sort - total_issues
            | rename
              data_sourcetype as Sourcetype
              total_issues as "Total Issues"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</dashboard>